###################################################################################################
#### Configuration des variables d'environnement pour l'API
#### À CONFIGURER dans la console AWS EB après création de l'application
###################################################################################################

option_settings:
  # Configuration du conteneur Docker
  aws:elasticbeanstalk:container:python:
    WSGIPath: api.main:app

  # Variables d'environnement (à surcharger dans AWS Console)
  aws:elasticbeanstalk:application:environment:
    # Configuration du modèle MLflow
    MODEL_NAME: "w2v_200K_model"
    MODEL_VERSION: "2"
    # Alternative: MODEL_STAGE: "Production"

    # Configuration MLflow (si serveur distant)
    # MLFLOW_TRACKING_URI: "http://mlflow-server:5001"

    # Configuration des alertes
    ALERT_WINDOW_MINUTES: "5"
    ALERT_THRESHOLD: "3"

    # Configuration Python
    PYTHONUNBUFFERED: "1"
    PYTHONPATH: "/var/app/current"

  # Configuration de l'instance EC2
  aws:autoscaling:launchconfiguration:
    IamInstanceProfile: aws-elasticbeanstalk-ec2-role
    InstanceType: t2.micro  # Free tier
    RootVolumeSize: 10
    RootVolumeType: gp2

  # Configuration de l'environnement
  aws:elasticbeanstalk:environment:
    ServiceRole: aws-elasticbeanstalk-service-role
    EnvironmentType: SingleInstance  # Pas de load balancer pour free tier

  # Configuration du health check
  aws:elasticbeanstalk:environment:process:default:
    HealthCheckPath: /health
    HealthCheckTimeout: 5
    HealthCheckInterval: 30
    UnhealthyThresholdCount: 3
    HealthyThresholdCount: 2

  # Configuration des mises à jour
  aws:elasticbeanstalk:managedactions:
    ManagedActionsEnabled: true
    PreferredStartTime: "Sun:03:00"

  aws:elasticbeanstalk:managedactions:platformupdate:
    UpdateLevel: minor
    InstanceRefreshEnabled: true

  # Configuration du déploiement
  aws:elasticbeanstalk:command:
    DeploymentPolicy: AllAtOnce
    Timeout: "600"

  # Optimisation des ressources pour t2.micro
  aws:elasticbeanstalk:container:python:staticfiles:
    /static: static